{% extends 'base.html' %}
{% block content %}
{% load static %}

<br>
<br>
<br>
<br>
<br>
<audio autoplay controls id="player"></audio>
<form action="/player" method="post" enctype="multipart/form-data" id='endconfirm'>
    {% csrf_token %}
    {{ endconfirm }}
<input type="submit" value="Submit" id="ender" hidden>
<button onclick="next()">Next</button>
</form>
<div class="nowplaying" style="color: var(--acc);"></div>

<script>
    //song array
    var song_list = [
        {% for song in songlist %}
        "{{ song }}",
        {% endfor %}
    ];


    for (let i = 0; i < song_list.length; i++) {
        song_list[i] = song_list[i].replace(/&#x27;/g, "'");     
    } //Unicode character correction for song names that have apostrophe in them.


    var player = document.getElementById('player');

    player.src = song_list[0]; //loading first song from song list

    //Checking whether playlist is empty
    if(song_list.length == 0){
        alert("Playlist empty. Please drop a song from DJ mode.");
        location.href = "/";
    }

    //Now playing
    document.getElementsByClassName('nowplaying')[0].innerHTML = song_list[i].slice(25, );


    player.play();
    //next function to send post request to backend and delete song
    function next() {
        player.src = ' ';
        document.getElementById('ender').click();
        location.href = "/loading"
    }

    //function for avoiding repeated post requests on reloads (sort of a noob method, ik xP)
    var flag = 0;
    function reloadprotection() {
        if (flag == 0)
        {location.href = "/loading";
        flag = 1;}
        else{
            flag = 0;
        }
    }
    document.addEventListener('reload', reloadprotection);

    
</script>

{% endblock %}